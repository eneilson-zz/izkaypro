binary-debuggable-source
0000 0000 f tools/rtctest.z
0000 0000 s ; RTCTEST.Z â€” CP/M program to test RTC interrupts on Kaypro 4-84
0000 0000 s ;
0000 0000 s ; Sets up IM2 with PIO vector, configures the MM58167A for 1/sec
0000 0000 s ; interrupts, and displays updating date/time on the console.
0000 0000 s ;
0000 0000 s ; Assemble with zmac:
0000 0000 s ;   zmac tools/rtctest.z
0000 0000 s ;   cp zout/rtctest.cim disks/rtctest.com
0000 0000 s ;
0000 0000 s 
0000 0000 s ; --- Constants ---
0000 0000 s BDOS		equ	0005h
0000 0000 s BDOS_COUT	equ	02h
0000 0000 s BDOS_PSTR	equ	09h
0000 0000 s BDOS_CSTAT	equ	0Bh
0000 0000 s BDOS_CIN	equ	01h
0000 0000 s 
0000 0000 s PIO_VECTOR	equ	20h
0000 0000 s I_REG_VAL	equ	04h
0000 0000 s VEC_TABLE	equ	I_REG_VAL * 256		; 0400h
0000 0000 s VEC_ENTRY	equ	VEC_TABLE + PIO_VECTOR	; 0420h
0000 0000 s 
0000 0000 s PORT_CLKADD	equ	20h
0000 0000 s PORT_CLKCTL	equ	22h
0000 0000 s PORT_CLKDAT	equ	24h
0000 0000 s 
0100 0100 s 	org	0100h
0100 0100 s 
0100 0100 s ; --- Entry point ---
0100 0100 d c3c202
0100 0100 u 03 01
0100 0100 s 	jp	main
0103 0103 s 
0103 0103 s ; --- Variables (jumped over, never executed) ---
0103 0103 d 00
0103 0103 u 01 02
0103 0103 s flag:		db	0
0104 0104 d 0000
0104 0104 u 02 02
0104 0104 s tick_count:	dw	0
0106 0106 s 
0106 0106 s ; --- Strings ---
0106 0106 s str_title:
0106 0106 d 1b3d2020
0106 0106 u 04 02
0106 0106 s 	db	1Bh,'=',' ',' '		; ADM-3A cursor home
010a 010a d 52544320496e7465727275707420436c6f636b20546573740d0a
010a 010a u 1a 02
010a 010a s 	db	'RTC Interrupt Clock Test',0Dh,0Ah
0124 0124 d 3d3d3d3d3d3d3d3d3d3d3d3d3d3d3d3d3d3d3d3d3d3d3d3d0d0a0d0a24
0124 0124 u 1d 02
0124 0124 s 	db	'========================',0Dh,0Ah,0Dh,0Ah,'$'
0141 0141 s 
0141 0141 s str_reading:
0141 0141 d 52656164696e6720525443206469726563746c793a202024
0141 0141 u 18 02
0141 0141 s 	db	'Reading RTC directly:  $'
0159 0159 s 
0159 0159 s str_setup:
0159 0159 d 0d0a0d0a
0159 0159 u 04 02
0159 0159 s 	db	0Dh,0Ah,0Dh,0Ah
015d 015d d 53657474696e6720757020494d32202b2050494f202b2052544320312f73656320696e746572727570742e2e2e0d0a24
015d 015d u 30 02
015d 015d s 	db	'Setting up IM2 + PIO + RTC 1/sec interrupt...',0Dh,0Ah,'$'
018d 018d s 
018d 018d s str_done:
018d 018d d 446f6e652e2057616974696e6720666f72207469636b732e0d0a0d0a24
018d 018d u 1d 02
018d 018d s 	db	'Done. Waiting for ticks.',0Dh,0Ah,0Dh,0Ah,'$'
01aa 01aa s 
01aa 01aa s str_exit:
01aa 01aa d 0d0a0d0a
01aa 01aa u 04 02
01aa 01aa s 	db	0Dh,0Ah,0Dh,0Ah
01ae 01ae d 44697361626c696e6720696e74657272757074732c2065786974696e672e0d0a24
01ae 01ae u 21 02
01ae 01ae s 	db	'Disabling interrupts, exiting.',0Dh,0Ah,'$'
01cf 01cf s 
01cf 01cf s str_tick:
01cf 01cf d 0d20205469636b2024
01cf 01cf u 09 02
01cf 01cf s 	db	0Dh,'  Tick $'
01d8 01d8 s 
01d8 01d8 s str_date:
01d8 01d8 d 202020446174653a2024
01d8 01d8 u 0a 02
01d8 01d8 s 	db	'   Date: $'
01e2 01e2 s 
01e2 01e2 s str_time:
01e2 01e2 d 202054696d653a2024
01e2 01e2 u 09 02
01e2 01e2 s 	db	'  Time: $'
01eb 01eb s 
01eb 01eb s str_slash:
01eb 01eb d 2f24
01eb 01eb u 02 02
01eb 01eb s 	db	'/$'
01ed 01ed s 
01ed 01ed s str_colon:
01ed 01ed d 3a24
01ed 01ed u 02 02
01ed 01ed s 	db	':$'
01ef 01ef s 
01ef 01ef s str_press:
01ef 01ef d 507265737320616e79206b657920746f20657869742e0d0a0d0a24
01ef 01ef u 1b 02
01ef 01ef s 	db	'Press any key to exit.',0Dh,0Ah,0Dh,0Ah,'$'
020a 020a s 
020a 020a s 
020a 020a s ; =========================================================
020a 020a s ; Subroutines
020a 020a s ; =========================================================
020a 020a s 
020a 020a s ; --- print_str: DE = $ terminated string, calls BDOS 9 ---
020a 020a s print_str:
020a 020a d 0e09
020a 020a u 02 01
020a 020a s 	ld	c,BDOS_PSTR
020c 020c d cd0500
020c 020c u 03 01
020c 020c s 	call	BDOS
020f 020f d c9
020f 020f u 01 01
020f 020f s 	ret
0210 0210 s 
0210 0210 s ; --- print_bcd: A = BCD byte, prints two ASCII digits ---
0210 0210 s print_bcd:
0210 0210 d f5
0210 0210 u 01 01
0210 0210 s 	push	af
0211 0211 d 0f
0211 0211 u 01 01
0211 0211 s 	rrca
0212 0212 d 0f
0212 0212 u 01 01
0212 0212 s 	rrca
0213 0213 d 0f
0213 0213 u 01 01
0213 0213 s 	rrca
0214 0214 d 0f
0214 0214 u 01 01
0214 0214 s 	rrca
0215 0215 d e60f
0215 0215 u 02 01
0215 0215 s 	and	0Fh
0217 0217 d c630
0217 0217 u 02 01
0217 0217 s 	add	a,'0'
0219 0219 d 5f
0219 0219 u 01 01
0219 0219 s 	ld	e,a
021a 021a d 0e02
021a 021a u 02 01
021a 021a s 	ld	c,BDOS_COUT
021c 021c d cd0500
021c 021c u 03 01
021c 021c s 	call	BDOS
021f 021f d f1
021f 021f u 01 01
021f 021f s 	pop	af
0220 0220 d e60f
0220 0220 u 02 01
0220 0220 s 	and	0Fh
0222 0222 d c630
0222 0222 u 02 01
0222 0222 s 	add	a,'0'
0224 0224 d 5f
0224 0224 u 01 01
0224 0224 s 	ld	e,a
0225 0225 d 0e02
0225 0225 u 02 01
0225 0225 s 	ld	c,BDOS_COUT
0227 0227 d cd0500
0227 0227 u 03 01
0227 0227 s 	call	BDOS
022a 022a d c9
022a 022a u 01 01
022a 022a s 	ret
022b 022b s 
022b 022b s ; --- print_dec16: HL = 16-bit value, prints as decimal ---
022b 022b s print_dec16:
022b 022b d 011027
022b 022b u 03 01
022b 022b s 	ld	bc,10000
022e 022e d cd4d02
022e 022e u 03 01
022e 022e s 	call	print_digit
0231 0231 d 01e803
0231 0231 u 03 01
0231 0231 s 	ld	bc,1000
0234 0234 d cd4d02
0234 0234 u 03 01
0234 0234 s 	call	print_digit
0237 0237 d 016400
0237 0237 u 03 01
0237 0237 s 	ld	bc,100
023a 023a d cd4d02
023a 023a u 03 01
023a 023a s 	call	print_digit
023d 023d d 010a00
023d 023d u 03 01
023d 023d s 	ld	bc,10
0240 0240 d cd4d02
0240 0240 u 03 01
0240 0240 s 	call	print_digit
0243 0243 d 7d
0243 0243 u 01 01
0243 0243 s 	ld	a,l
0244 0244 d c630
0244 0244 u 02 01
0244 0244 s 	add	a,'0'
0246 0246 d 5f
0246 0246 u 01 01
0246 0246 s 	ld	e,a
0247 0247 d 0e02
0247 0247 u 02 01
0247 0247 s 	ld	c,BDOS_COUT
0249 0249 d cd0500
0249 0249 u 03 01
0249 0249 s 	call	BDOS
024c 024c d c9
024c 024c u 01 01
024c 024c s 	ret
024d 024d s 
024d 024d s print_digit:
024d 024d d 3e2f
024d 024d u 02 01
024d 024d s 	ld	a,'0'-1
024f 024f s .loop:
024f 024f d 3c
024f 024f u 01 01
024f 024f s 	inc	a
0250 0250 d b7
0250 0250 u 01 01
0250 0250 s 	or	a			; clear carry
0251 0251 d ed42
0251 0251 u 02 01
0251 0251 s 	sbc	hl,bc
0253 0253 d 30fa
0253 0253 u 02 01
0253 0253 s 	jr	nc,.loop
0255 0255 d 09
0255 0255 u 01 01
0255 0255 s 	add	hl,bc
0256 0256 d 5f
0256 0256 u 01 01
0256 0256 s 	ld	e,a
0257 0257 d 0e02
0257 0257 u 02 01
0257 0257 s 	ld	c,BDOS_COUT
0259 0259 d cd0500
0259 0259 u 03 01
0259 0259 s 	call	BDOS
025c 025c d c9
025c 025c u 01 01
025c 025c s 	ret
025d 025d s 
025d 025d s ; --- read_rtc_reg: A = register number, returns A = BCD value ---
025d 025d s read_rtc_reg:
025d 025d d d320
025d 025d u 02 01
025d 025d s 	out	(PORT_CLKADD),a
025f 025f d db24
025f 025f u 02 01
025f 025f s 	in	a,(PORT_CLKDAT)
0261 0261 d c9
0261 0261 u 01 01
0261 0261 s 	ret
0262 0262 s 
0262 0262 s ; --- display_datetime: reads and prints MM/DD  HH:MM:SS ---
0262 0262 s display_datetime:
0262 0262 d 11d801
0262 0262 u 03 01
0262 0262 s 	ld	de,str_date
0265 0265 d cd0a02
0265 0265 u 03 01
0265 0265 s 	call	print_str
0268 0268 s 
0268 0268 d 3e07
0268 0268 u 02 01
0268 0268 s 	ld	a,07h			; month
026a 026a d cd5d02
026a 026a u 03 01
026a 026a s 	call	read_rtc_reg
026d 026d d cd1002
026d 026d u 03 01
026d 026d s 	call	print_bcd
0270 0270 s 
0270 0270 d 11eb01
0270 0270 u 03 01
0270 0270 s 	ld	de,str_slash
0273 0273 d cd0a02
0273 0273 u 03 01
0273 0273 s 	call	print_str
0276 0276 s 
0276 0276 d 3e06
0276 0276 u 02 01
0276 0276 s 	ld	a,06h			; day
0278 0278 d cd5d02
0278 0278 u 03 01
0278 0278 s 	call	read_rtc_reg
027b 027b d cd1002
027b 027b u 03 01
027b 027b s 	call	print_bcd
027e 027e s 
027e 027e d 11e201
027e 027e u 03 01
027e 027e s 	ld	de,str_time
0281 0281 d cd0a02
0281 0281 u 03 01
0281 0281 s 	call	print_str
0284 0284 s 
0284 0284 d 3e04
0284 0284 u 02 01
0284 0284 s 	ld	a,04h			; hours
0286 0286 d cd5d02
0286 0286 u 03 01
0286 0286 s 	call	read_rtc_reg
0289 0289 d cd1002
0289 0289 u 03 01
0289 0289 s 	call	print_bcd
028c 028c s 
028c 028c d 11ed01
028c 028c u 03 01
028c 028c s 	ld	de,str_colon
028f 028f d cd0a02
028f 028f u 03 01
028f 028f s 	call	print_str
0292 0292 s 
0292 0292 d 3e03
0292 0292 u 02 01
0292 0292 s 	ld	a,03h			; minutes
0294 0294 d cd5d02
0294 0294 u 03 01
0294 0294 s 	call	read_rtc_reg
0297 0297 d cd1002
0297 0297 u 03 01
0297 0297 s 	call	print_bcd
029a 029a s 
029a 029a d 11ed01
029a 029a u 03 01
029a 029a s 	ld	de,str_colon
029d 029d d cd0a02
029d 029d u 03 01
029d 029d s 	call	print_str
02a0 02a0 s 
02a0 02a0 d 3e02
02a0 02a0 u 02 01
02a0 02a0 s 	ld	a,02h			; seconds
02a2 02a2 d cd5d02
02a2 02a2 u 03 01
02a2 02a2 s 	call	read_rtc_reg
02a5 02a5 d cd1002
02a5 02a5 u 03 01
02a5 02a5 s 	call	print_bcd
02a8 02a8 s 
02a8 02a8 d c9
02a8 02a8 u 01 01
02a8 02a8 s 	ret
02a9 02a9 s 
02a9 02a9 s 
02a9 02a9 s ; =========================================================
02a9 02a9 s ; Interrupt Service Routine
02a9 02a9 s ; =========================================================
02a9 02a9 s 
02a9 02a9 s isr:
02a9 02a9 d f5
02a9 02a9 u 01 01
02a9 02a9 s 	push	af
02aa 02aa d e5
02aa 02aa u 01 01
02aa 02aa s 	push	hl
02ab 02ab s 
02ab 02ab s 	; Acknowledge interrupt: read status register to clear it
02ab 02ab d 3e10
02ab 02ab u 02 01
02ab 02ab s 	ld	a,10h			; interrupt status register
02ad 02ad d d320
02ad 02ad u 02 01
02ad 02ad s 	out	(PORT_CLKADD),a
02af 02af d db24
02af 02af u 02 01
02af 02af s 	in	a,(PORT_CLKDAT)		; read clears interrupt
02b1 02b1 s 
02b1 02b1 s 	; Set flag for main loop
02b1 02b1 d 3e01
02b1 02b1 u 02 01
02b1 02b1 s 	ld	a,1
02b3 02b3 d 320301
02b3 02b3 u 03 01
02b3 02b3 s 	ld	(flag),a
02b6 02b6 s 
02b6 02b6 s 	; Increment 16-bit tick counter
02b6 02b6 d 2a0401
02b6 02b6 u 03 01
02b6 02b6 s 	ld	hl,(tick_count)
02b9 02b9 d 23
02b9 02b9 u 01 01
02b9 02b9 s 	inc	hl
02ba 02ba d 220401
02ba 02ba u 03 01
02ba 02ba s 	ld	(tick_count),hl
02bd 02bd s 
02bd 02bd d e1
02bd 02bd u 01 01
02bd 02bd s 	pop	hl
02be 02be d f1
02be 02be u 01 01
02be 02be s 	pop	af
02bf 02bf d fb
02bf 02bf u 01 01
02bf 02bf s 	ei
02c0 02c0 d ed4d
02c0 02c0 u 02 01
02c0 02c0 s 	reti
02c2 02c2 s 
02c2 02c2 s 
02c2 02c2 s ; =========================================================
02c2 02c2 s ; Main Program
02c2 02c2 s ; =========================================================
02c2 02c2 s 
02c2 02c2 s main:
02c2 02c2 s 	; Print title (clears screen via cursor home)
02c2 02c2 d 110601
02c2 02c2 u 03 01
02c2 02c2 s 	ld	de,str_title
02c5 02c5 d cd0a02
02c5 02c5 u 03 01
02c5 02c5 s 	call	print_str
02c8 02c8 s 
02c8 02c8 s 	; Show direct RTC read
02c8 02c8 d 114101
02c8 02c8 u 03 01
02c8 02c8 s 	ld	de,str_reading
02cb 02cb d cd0a02
02cb 02cb u 03 01
02cb 02cb s 	call	print_str
02ce 02ce d cd6202
02ce 02ce u 03 01
02ce 02ce s 	call	display_datetime
02d1 02d1 s 
02d1 02d1 s 	; Print setup message
02d1 02d1 d 115901
02d1 02d1 u 03 01
02d1 02d1 s 	ld	de,str_setup
02d4 02d4 d cd0a02
02d4 02d4 u 03 01
02d4 02d4 s 	call	print_str
02d7 02d7 s 
02d7 02d7 s 	; --- Set up IM2 interrupt ---
02d7 02d7 d f3
02d7 02d7 u 01 01
02d7 02d7 s 	di
02d8 02d8 s 
02d8 02d8 s 	; Set I register
02d8 02d8 d 3e04
02d8 02d8 u 02 01
02d8 02d8 s 	ld	a,I_REG_VAL
02da 02da d ed47
02da 02da u 02 01
02da 02da s 	ld	i,a
02dc 02dc s 
02dc 02dc s 	; Switch to IM 2
02dc 02dc d ed5e
02dc 02dc u 02 01
02dc 02dc s 	im	2
02de 02de s 
02de 02de s 	; Store ISR address in vector table
02de 02de d 21a902
02de 02de u 03 01
02de 02de s 	ld	hl,isr
02e1 02e1 d 222004
02e1 02e1 u 03 01
02e1 02e1 s 	ld	(VEC_ENTRY),hl
02e4 02e4 s 
02e4 02e4 s 	; Configure PIO Port A for interrupts
02e4 02e4 d 3e20
02e4 02e4 u 02 01
02e4 02e4 s 	ld	a,PIO_VECTOR		; interrupt vector
02e6 02e6 d d322
02e6 02e6 u 02 01
02e6 02e6 s 	out	(PORT_CLKCTL),a
02e8 02e8 d 3ecf
02e8 02e8 u 02 01
02e8 02e8 s 	ld	a,0CFh			; mode 3
02ea 02ea d d322
02ea 02ea u 02 01
02ea 02ea s 	out	(PORT_CLKCTL),a
02ec 02ec d 3ee0
02ec 02ec u 02 01
02ec 02ec s 	ld	a,0E0h			; I/O mask
02ee 02ee d d322
02ee 02ee u 02 01
02ee 02ee s 	out	(PORT_CLKCTL),a
02f0 02f0 d 3e37
02f0 02f0 u 02 01
02f0 02f0 s 	ld	a,37h			; int control: active high, OR, mask follows
02f2 02f2 d d322
02f2 02f2 u 02 01
02f2 02f2 s 	out	(PORT_CLKCTL),a
02f4 02f4 d 3ebf
02f4 02f4 u 02 01
02f4 02f4 s 	ld	a,0BFh			; int mask: monitor bit 6
02f6 02f6 d d322
02f6 02f6 u 02 01
02f6 02f6 s 	out	(PORT_CLKCTL),a
02f8 02f8 s 
02f8 02f8 s 	; Configure RTC: enable 1/sec interrupt
02f8 02f8 d 3e11
02f8 02f8 u 02 01
02f8 02f8 s 	ld	a,11h			; interrupt control register
02fa 02fa d d320
02fa 02fa u 02 01
02fa 02fa s 	out	(PORT_CLKADD),a
02fc 02fc d 3e04
02fc 02fc u 02 01
02fc 02fc s 	ld	a,04h			; 1/sec interrupt
02fe 02fe d d324
02fe 02fe u 02 01
02fe 02fe s 	out	(PORT_CLKDAT),a
0300 0300 s 
0300 0300 s 	; Clear any pending interrupt status
0300 0300 d 3e10
0300 0300 u 02 01
0300 0300 s 	ld	a,10h			; interrupt status register
0302 0302 d d320
0302 0302 u 02 01
0302 0302 s 	out	(PORT_CLKADD),a
0304 0304 d db24
0304 0304 u 02 01
0304 0304 s 	in	a,(PORT_CLKDAT)		; read clears status
0306 0306 s 
0306 0306 s 	; Enable PIO interrupts
0306 0306 d 3e83
0306 0306 u 02 01
0306 0306 s 	ld	a,83h			; interrupt enable
0308 0308 d d322
0308 0308 u 02 01
0308 0308 s 	out	(PORT_CLKCTL),a
030a 030a s 
030a 030a s 	; Enable CPU interrupts
030a 030a d fb
030a 030a u 01 01
030a 030a s 	ei
030b 030b s 
030b 030b s 	; Print ready messages
030b 030b d 118d01
030b 030b u 03 01
030b 030b s 	ld	de,str_done
030e 030e d cd0a02
030e 030e u 03 01
030e 030e s 	call	print_str
0311 0311 d 11ef01
0311 0311 u 03 01
0311 0311 s 	ld	de,str_press
0314 0314 d cd0a02
0314 0314 u 03 01
0314 0314 s 	call	print_str
0317 0317 s 
0317 0317 s ; --- Main loop ---
0317 0317 s main_loop:
0317 0317 s 	; Check for keypress
0317 0317 d 0e0b
0317 0317 u 02 01
0317 0317 s 	ld	c,BDOS_CSTAT
0319 0319 d cd0500
0319 0319 u 03 01
0319 0319 s 	call	BDOS
031c 031c d b7
031c 031c u 01 01
031c 031c s 	or	a
031d 031d d 201b
031d 031d u 02 01
031d 031d s 	jr	nz,exit
031f 031f s 
031f 031f s 	; Check interrupt flag
031f 031f d 3a0301
031f 031f u 03 01
031f 031f s 	ld	a,(flag)
0322 0322 d b7
0322 0322 u 01 01
0322 0322 s 	or	a
0323 0323 d 28f2
0323 0323 u 02 01
0323 0323 s 	jr	z,main_loop
0325 0325 s 
0325 0325 s 	; Clear flag
0325 0325 d af
0325 0325 u 01 01
0325 0325 s 	xor	a
0326 0326 d 320301
0326 0326 u 03 01
0326 0326 s 	ld	(flag),a
0329 0329 s 
0329 0329 s 	; Print tick count
0329 0329 d 11cf01
0329 0329 u 03 01
0329 0329 s 	ld	de,str_tick
032c 032c d cd0a02
032c 032c u 03 01
032c 032c s 	call	print_str
032f 032f d 2a0401
032f 032f u 03 01
032f 032f s 	ld	hl,(tick_count)
0332 0332 d cd2b02
0332 0332 u 03 01
0332 0332 s 	call	print_dec16
0335 0335 s 
0335 0335 s 	; Display date/time
0335 0335 d cd6202
0335 0335 u 03 01
0335 0335 s 	call	display_datetime
0338 0338 s 
0338 0338 d 18dd
0338 0338 u 02 01
0338 0338 s 	jr	main_loop
033a 033a s 
033a 033a s ; --- Exit ---
033a 033a s exit:
033a 033a d f3
033a 033a u 01 01
033a 033a s 	di
033b 033b s 
033b 033b s 	; Disable RTC interrupts
033b 033b d 3e11
033b 033b u 02 01
033b 033b s 	ld	a,11h
033d 033d d d320
033d 033d u 02 01
033d 033d s 	out	(PORT_CLKADD),a
033f 033f d 3e00
033f 033f u 02 01
033f 033f s 	ld	a,00h
0341 0341 d d324
0341 0341 u 02 01
0341 0341 s 	out	(PORT_CLKDAT),a
0343 0343 s 
0343 0343 s 	; Disable PIO interrupts
0343 0343 d 3e03
0343 0343 u 02 01
0343 0343 s 	ld	a,03h
0345 0345 d d322
0345 0345 u 02 01
0345 0345 s 	out	(PORT_CLKCTL),a
0347 0347 s 
0347 0347 s 	; Restore IM 1
0347 0347 d ed56
0347 0347 u 02 01
0347 0347 s 	im	1
0349 0349 d fb
0349 0349 u 01 01
0349 0349 s 	ei
034a 034a s 
034a 034a s 	; Consume the keypress
034a 034a d 0e01
034a 034a u 02 01
034a 034a s 	ld	c,BDOS_CIN
034c 034c d cd0500
034c 034c u 03 01
034c 034c s 	call	BDOS
034f 034f s 
034f 034f s 	; Print exit message
034f 034f d 11aa01
034f 034f u 03 01
034f 034f s 	ld	de,str_exit
0352 0352 d cd0a02
0352 0352 u 03 01
0352 0352 s 	call	print_str
0355 0355 s 
0355 0355 s 	; Warm boot
0355 0355 d c30000
0355 0355 u 03 01
0355 0355 s 	jp	0000h
0358 0358 s 
0358 0358 s 
0358 0358 s ; =========================================================
0358 0358 s ; Pad to vector table and reserve space for it
0358 0358 s ; =========================================================
0358 0358 s 
0358 0358 s 	; Pad to vector table boundary
0358 0358 s  if $ > VEC_TABLE
0358 0358 s 	.error "Code overlaps vector table!"
0358 0358 s  endif
0358 0358 s 
0400 0400 s 	org	VEC_TABLE
0400 0400 s vector_table:
0400 0400 s 	ds	256,0			; 256 bytes of vector table
0400 0400 d 00000000000000000000000000000000
0410 0410 d 00000000000000000000000000000000
0420 0420 d 00000000000000000000000000000000
0430 0430 d 00000000000000000000000000000000
0440 0440 d 00000000000000000000000000000000
0450 0450 d 00000000000000000000000000000000
0460 0460 d 00000000000000000000000000000000
0470 0470 d 00000000000000000000000000000000
0480 0480 d 00000000000000000000000000000000
0490 0490 d 00000000000000000000000000000000
04a0 04a0 d 00000000000000000000000000000000
04b0 04b0 d 00000000000000000000000000000000
04c0 04c0 d 00000000000000000000000000000000
04d0 04d0 d 00000000000000000000000000000000
04e0 04e0 d 00000000000000000000000000000000
04f0 04f0 d 00000000000000000000000000000000
0400 0400 u ff 02
04ff 04ff u 01 02
0500 0500 s 
0500 0500 s 	end
0400 a vector_table
033a a exit
024d a print_digit
01aa a str_exit
02a9 a isr
024f a .loop
01ef a str_press
02c2 a main
0004 v I_REG_VAL
0262 a display_datetime
0400 v VEC_TABLE
022b a print_dec16
0317 a main_loop
0002 v BDOS_COUT
000b v BDOS_CSTAT
0009 v BDOS_PSTR
0159 a str_setup
020a a print_str
01ed a str_colon
0104 a tick_count
018d a str_done
01eb a str_slash
01cf a str_tick
01e2 a str_time
0020 v PORT_CLKADD
0103 a flag
0210 a print_bcd
0001 v BDOS_CIN
0020 v PIO_VECTOR
025d a read_rtc_reg
0005 v BDOS
0022 v PORT_CLKCTL
0024 v PORT_CLKDAT
0420 v VEC_ENTRY
0106 a str_title
0141 a str_reading
01d8 a str_date
