   1:				; EMUTEST.COM - Emulator ROM and RAM diagnostics
   2:				; Based on diag4.mac from Non-Linear Systems, Inc. (1983)
   3:				; Implements proper ROM bank switching by relocating code to 0x8000
   4:				; 
   5:				; Tests:
   6:				;   1. ROM Checksum - switches to ROM bank, calculates checksum
   7:				;   2. RAM Tests - sliding-data and address-data on 0x4000-0xBFFF
   8:				;   3. Video RAM (0x0000-0x07FF) - character RAM via SY6545 CRTC
   9:				;   4. Attribute RAM (0x0800-0x0FFF) - attribute RAM via SY6545 CRTC
  10:				;
  11:				; SY6545 CRTC transparent addressing protocol:
  12:				;   Port 0x1C: Register select (R18=addr_hi, R19=addr_lo)
  13:				;   Port 0x1D: Register data
  14:				;   Port 0x1F: VRAM data read/write + strobe control
  15:				;   Wait for port 0x1C bit 7 = 1 (Update Ready) after strobe
  16:				
  17:				; CP/M BDOS calls
  18:     -	0005          	bdos:           equ     5
  19:     -	0002          	conout:         equ     2
  20:     -	0009          	prtstr:         equ     9
  21:				
  22:				; Kaypro 4-84 ports
  23:     -	0014          	bitport:        equ     014h
  24:				
  25:				; SY6545 CRTC ports and commands (from diag4.mac univ=true)
  26:     -	001C          	crtc_reg:       equ     01Ch    ; CRTC register select
  27:     -	001D          	crtc_data:      equ     01Dh    ; CRTC register data
  28:     -	001F          	crtc_vram:      equ     01Fh    ; CRTC VRAM data / strobe
  29:     -	001F          	strcmd:         equ     01Fh    ; Strobe command value
  30:				
  31:     -	0100          	        org     0100h
  32:				
  33:				; ============================================================================
  34:				; Main program
  35:				; ============================================================================
  36:     -	0100          	start:
  37:    0+10	0100  317E05  	        ld      sp, stack
  38:				
  39:				        ; Print banner
  40:   10+10	0103  114004  	        ld      de, msg_banner
  41:   20+17	0106  CD1D04  	        call    print
  42:				
  43:				        ; Test 1: ROM checksum
  44:   37+17	0109  CD1C01  	        call    rom_test
  45:				
  46:				        ; Test 2: RAM tests
  47:   54+17	010C  CD6C01  	        call    ram_test
  48:				
  49:				        ; Test 3: Video RAM test (SY6545 CRTC)
  50:   71+17	010F  CD5302  	        call    vram_test
  51:				
  52:				        ; Test 4: Attribute RAM test (SY6545 CRTC)
  53:   88+17	0112  CD7203  	        call    attr_test
  54:				
  55:				        ; Print completion message
  56:  105+10	0115  112105  	        ld      de, msg_done
  57:  115+17	0118  CD1D04  	        call    print
  58:				
  59:				        ; Return to CP/M
  60:  132+11	011B  C7      	        rst     0
  61:				
  62:				; ============================================================================
  63:				; ROM Checksum Test
  64:				; Copies test code to 0x8000, executes there to read ROM while banked in
  65:				; ============================================================================
  66:     -	011C          	rom_test:
  67:  143+10	011C  119204  	        ld      de, msg_rom
  68:  153+17	011F  CD1D04  	        call    print
  69:				
  70:				        ; Copy ROM test routine to 0x8000
  71:  170+10	0122  214201  	        ld      hl, rom_code_start
  72:  180+10	0125  110080  	        ld      de, 08000h
  73:  190+10	0128  012A00  	        ld      bc, rom_code_end - rom_code_start
  74:  200+16+5	012B  EDB0    	        ldir
  75:				
  76:				        ; Jump to relocated code at 0x8000
  77:				        ; It will calculate checksum and return here via rom_return
  78:  216+10	012D  C30080  	        jp      08000h
  79:				
  80:     -	0130          	rom_return:
  81:				        ; HL now contains the checksum (returned from relocated code)
  82:  226+11	0130  E5      	        push    hl
  83:				
  84:				        ; Print checksum value
  85:  237+10	0131  11A604  	        ld      de, msg_chksum
  86:  247+17	0134  CD1D04  	        call    print
  87:  264+10	0137  E1      	        pop     hl
  88:  274+17	0138  CD2204  	        call    print_hex16
  89:				
  90:  291+10	013B  113B05  	        ld      de, msg_crlf
  91:  301+17	013E  CD1D04  	        call    print
  92:  318+10	0141  C9      	        ret
  93:				
  94:				; ============================================================================
  95:				; ROM test code - gets copied to 0x8000 and executed there
  96:				; This code must be position-independent or use absolute addresses at 0x8000
  97:				; ============================================================================
  98:     -	0142          	rom_code_start:
  99:				        ; This code runs at 0x8000
 100:				        
 101:				        ; Save current bank state
 102:  328+11	0142  DB14    	        in      a, (bitport)
 103:  339+11	0144  F5      	        push    af
 104:				
 105:				        ; Switch to ROM bank (set bit 7)
 106:  350+7	0145  F680    	        or      080h
 107:  357+11	0147  D314    	        out     (bitport), a
 108:				
 109:				        ; Calculate checksum of first 4KB (0x0000-0x0FFF)
 110:				        ; HL = checksum accumulator, DE = address pointer
 111:  368+10	0149  210000  	        ld      hl, 0
 112:  378+10	014C  110000  	        ld      de, 0
 113:  388+10	014F  010010  	        ld      bc, 01000h          ; 4KB = 0x1000 bytes
 114:				
 115:     -	0152          	rom_calc_loop:
 116:  398+7	0152  1A      	        ld      a, (de)             ; Read ROM byte
 117:  405+4	0153  85      	        add     a, l                ; Add to low byte of checksum
 118:  409+4	0154  6F      	        ld      l, a
 119:  413+7+5	0155  3001    	        jr      nc, rom_no_carry
 120:  420+4	0157  24      	        inc     h                   ; Carry to high byte
 121:     -	0158          	rom_no_carry:
 122:  424+6	0158  13      	        inc     de
 123:  430+6	0159  0B      	        dec     bc
 124:  436+4	015A  78      	        ld      a, b
 125:  440+4	015B  B1      	        or      c
 126:  444+7+5	015C  20F4    	        jr      nz, rom_calc_loop
 127:				
 128:				        ; Save checksum in IX (safe across bank switch)
 129:  451+11	015E  E5      	        push    hl
 130:  462+14	015F  DDE1    	        pop     ix
 131:				
 132:				        ; Switch back to RAM bank (clear bit 7)
 133:  476+10	0161  F1      	        pop     af                  ; Get saved port value
 134:  486+8	0162  CBBF    	        res     7, a
 135:  494+11	0164  D314    	        out     (bitport), a
 136:				
 137:				        ; Restore checksum to HL from IX
 138:  505+15	0166  DDE5    	        push    ix
 139:  520+10	0168  E1      	        pop     hl
 140:				
 141:				        ; Jump back to main code (absolute address)
 142:  530+10	0169  C33001  	        jp      rom_return
 143:				
 144:     -	016C          	rom_code_end:
 145:				
 146:				; ============================================================================
 147:				; RAM Tests
 148:				; ============================================================================
 149:     -	016C          	ram_test:
 150:				        ; Test region 0x4000-0x7FFF
 151:  540+10	016C  11A904  	        ld      de, msg_ram1
 152:  550+17	016F  CD1D04  	        call    print
 153:				
 154:  567+10	0172  210040  	        ld      hl, 04000h
 155:  577+10	0175  11FF7F  	        ld      de, 07FFFh
 156:  587+17	0178  CDC001  	        call    sliding_data
 157:  604+7+5	017B  2013    	        jr      nz, ram_fail1
 158:				
 159:  611+10	017D  210040  	        ld      hl, 04000h
 160:  621+10	0180  11FF7F  	        ld      de, 07FFFh
 161:  631+17	0183  CD0102  	        call    address_data
 162:  648+7+5	0186  2008    	        jr      nz, ram_fail1
 163:				
 164:  655+10	0188  111305  	        ld      de, msg_pass
 165:  665+17	018B  CD1D04  	        call    print
 166:  682+12	018E  1806    	        jr      ram_test2
 167:				
 168:     -	0190          	ram_fail1:
 169:  694+10	0190  111A05  	        ld      de, msg_fail
 170:  704+17	0193  CD1D04  	        call    print
 171:				
 172:     -	0196          	ram_test2:
 173:				        ; Test region 0x8000-0xBFFF
 174:  721+10	0196  11C204  	        ld      de, msg_ram2
 175:  731+17	0199  CD1D04  	        call    print
 176:				
 177:  748+10	019C  210080  	        ld      hl, 08000h
 178:  758+10	019F  11FFBF  	        ld      de, 0BFFFh
 179:  768+17	01A2  CDC001  	        call    sliding_data
 180:  785+7+5	01A5  2012    	        jr      nz, ram_fail2
 181:				
 182:  792+10	01A7  210080  	        ld      hl, 08000h
 183:  802+10	01AA  11FFBF  	        ld      de, 0BFFFh
 184:  812+17	01AD  CD0102  	        call    address_data
 185:  829+7+5	01B0  2007    	        jr      nz, ram_fail2
 186:				
 187:  836+10	01B2  111305  	        ld      de, msg_pass
 188:  846+17	01B5  CD1D04  	        call    print
 189:  863+10	01B8  C9      	        ret
 190:				
 191:     -	01B9          	ram_fail2:
 192:  873+10	01B9  111A05  	        ld      de, msg_fail
 193:  883+17	01BC  CD1D04  	        call    print
 194:  900+10	01BF  C9      	        ret
 195:				
 196:				; ============================================================================
 197:				; Sliding Data Test
 198:				; Input: HL = start, DE = end
 199:				; Output: Z=pass, NZ=fail
 200:				; ============================================================================
 201:     -	01C0          	sliding_data:
 202:  910+11	01C0  E5      	        push    hl
 203:  921+11	01C1  D5      	        push    de
 204:				
 205:  932+7	01C2  0601    	        ld      b, 1            ; Initial pattern
 206:     -	01C4          	sd_outer:
 207:  939+7	01C4  0E08    	        ld      c, 8            ; 8 bit positions
 208:				
 209:     -	01C6          	sd_bit:
 210:  946+10	01C6  D1      	        pop     de
 211:  956+10	01C7  E1      	        pop     hl
 212:  966+11	01C8  E5      	        push    hl
 213:  977+11	01C9  D5      	        push    de
 214:				
 215:     -	01CA          	sd_write:
 216:  988+7	01CA  70      	        ld      (hl), b
 217:  995+4	01CB  7C      	        ld      a, h
 218:  999+4	01CC  BA      	        cp      d
 219: 1003+7+5	01CD  2004    	        jr      nz, sd_winc
 220: 1010+4	01CF  7D      	        ld      a, l
 221: 1014+4	01D0  BB      	        cp      e
 222: 1018+7+5	01D1  2803    	        jr      z, sd_verify
 223:     -	01D3          	sd_winc:
 224: 1025+6	01D3  23      	        inc     hl
 225: 1031+12	01D4  18F4    	        jr      sd_write
 226:				
 227:     -	01D6          	sd_verify:
 228: 1043+10	01D6  D1      	        pop     de
 229: 1053+10	01D7  E1      	        pop     hl
 230: 1063+11	01D8  E5      	        push    hl
 231: 1074+11	01D9  D5      	        push    de
 232:				
 233:     -	01DA          	sd_read:
 234: 1085+7	01DA  7E      	        ld      a, (hl)
 235: 1092+4	01DB  B8      	        cp      b
 236: 1096+7+5	01DC  201D    	        jr      nz, sd_fail
 237: 1103+4	01DE  7C      	        ld      a, h
 238: 1107+4	01DF  BA      	        cp      d
 239: 1111+7+5	01E0  2004    	        jr      nz, sd_rinc
 240: 1118+4	01E2  7D      	        ld      a, l
 241: 1122+4	01E3  BB      	        cp      e
 242: 1126+7+5	01E4  2803    	        jr      z, sd_next
 243:     -	01E6          	sd_rinc:
 244: 1133+6	01E6  23      	        inc     hl
 245: 1139+12	01E7  18F1    	        jr      sd_read
 246:				
 247:     -	01E9          	sd_next:
 248: 1151+8	01E9  CB00    	        rlc     b
 249: 1159+4	01EB  0D      	        dec     c
 250: 1163+7+5	01EC  20D8    	        jr      nz, sd_bit
 251:				
 252: 1170+4	01EE  78      	        ld      a, b
 253: 1174+7	01EF  FE01    	        cp      1
 254: 1181+7+5	01F1  2004    	        jr      nz, sd_done
 255: 1188+7	01F3  06FE    	        ld      b, 0FEh
 256: 1195+12	01F5  18CD    	        jr      sd_outer
 257:				
 258:     -	01F7          	sd_done:
 259: 1207+10	01F7  D1      	        pop     de
 260: 1217+10	01F8  E1      	        pop     hl
 261: 1227+4	01F9  AF      	        xor     a
 262: 1231+10	01FA  C9      	        ret
 263:				
 264:     -	01FB          	sd_fail:
 265: 1241+10	01FB  D1      	        pop     de
 266: 1251+10	01FC  E1      	        pop     hl
 267: 1261+7	01FD  3E01    	        ld      a, 1
 268: 1268+4	01FF  B7      	        or      a
 269: 1272+10	0200  C9      	        ret
 270:				
 271:				; ============================================================================
 272:				; Address Data Test
 273:				; Input: HL = start, DE = end
 274:				; Output: Z=pass, NZ=fail
 275:				; ============================================================================
 276:     -	0201          	address_data:
 277: 1282+11	0201  E5      	        push    hl
 278: 1293+11	0202  D5      	        push    de
 279:				
 280:				        ; Write low bytes
 281: 1304+10	0203  D1      	        pop     de
 282: 1314+10	0204  E1      	        pop     hl
 283: 1324+11	0205  E5      	        push    hl
 284: 1335+11	0206  D5      	        push    de
 285:				
 286:     -	0207          	ad_wlo:
 287: 1346+7	0207  75      	        ld      (hl), l
 288: 1353+4	0208  7C      	        ld      a, h
 289: 1357+4	0209  BA      	        cp      d
 290: 1361+7+5	020A  2004    	        jr      nz, ad_wlinc
 291: 1368+4	020C  7D      	        ld      a, l
 292: 1372+4	020D  BB      	        cp      e
 293: 1376+7+5	020E  2803    	        jr      z, ad_vlo
 294:     -	0210          	ad_wlinc:
 295: 1383+6	0210  23      	        inc     hl
 296: 1389+12	0211  18F4    	        jr      ad_wlo
 297:				
 298:     -	0213          	ad_vlo:
 299:				        ; Verify low bytes
 300: 1401+10	0213  D1      	        pop     de
 301: 1411+10	0214  E1      	        pop     hl
 302: 1421+11	0215  E5      	        push    hl
 303: 1432+11	0216  D5      	        push    de
 304:				
 305:     -	0217          	ad_rlo:
 306: 1443+7	0217  7E      	        ld      a, (hl)
 307: 1450+4	0218  BD      	        cp      l
 308: 1454+7+5	0219  2032    	        jr      nz, ad_fail
 309: 1461+4	021B  7C      	        ld      a, h
 310: 1465+4	021C  BA      	        cp      d
 311: 1469+7+5	021D  2004    	        jr      nz, ad_rlinc
 312: 1476+4	021F  7D      	        ld      a, l
 313: 1480+4	0220  BB      	        cp      e
 314: 1484+7+5	0221  2803    	        jr      z, ad_whi
 315:     -	0223          	ad_rlinc:
 316: 1491+6	0223  23      	        inc     hl
 317: 1497+12	0224  18F1    	        jr      ad_rlo
 318:				
 319:     -	0226          	ad_whi:
 320:				        ; Write high bytes
 321: 1509+10	0226  D1      	        pop     de
 322: 1519+10	0227  E1      	        pop     hl
 323: 1529+11	0228  E5      	        push    hl
 324: 1540+11	0229  D5      	        push    de
 325:				
 326:     -	022A          	ad_wh:
 327: 1551+7	022A  74      	        ld      (hl), h
 328: 1558+4	022B  7C      	        ld      a, h
 329: 1562+4	022C  BA      	        cp      d
 330: 1566+7+5	022D  2004    	        jr      nz, ad_whinc
 331: 1573+4	022F  7D      	        ld      a, l
 332: 1577+4	0230  BB      	        cp      e
 333: 1581+7+5	0231  2803    	        jr      z, ad_vhi
 334:     -	0233          	ad_whinc:
 335: 1588+6	0233  23      	        inc     hl
 336: 1594+12	0234  18F4    	        jr      ad_wh
 337:				
 338:     -	0236          	ad_vhi:
 339:				        ; Verify high bytes
 340: 1606+10	0236  D1      	        pop     de
 341: 1616+10	0237  E1      	        pop     hl
 342: 1626+11	0238  E5      	        push    hl
 343: 1637+11	0239  D5      	        push    de
 344:				
 345:     -	023A          	ad_rhi:
 346: 1648+7	023A  7E      	        ld      a, (hl)
 347: 1655+4	023B  BC      	        cp      h
 348: 1659+7+5	023C  200F    	        jr      nz, ad_fail
 349: 1666+4	023E  7C      	        ld      a, h
 350: 1670+4	023F  BA      	        cp      d
 351: 1674+7+5	0240  2004    	        jr      nz, ad_rhinc
 352: 1681+4	0242  7D      	        ld      a, l
 353: 1685+4	0243  BB      	        cp      e
 354: 1689+7+5	0244  2803    	        jr      z, ad_done
 355:     -	0246          	ad_rhinc:
 356: 1696+6	0246  23      	        inc     hl
 357: 1702+12	0247  18F1    	        jr      ad_rhi
 358:				
 359:     -	0249          	ad_done:
 360: 1714+10	0249  D1      	        pop     de
 361: 1724+10	024A  E1      	        pop     hl
 362: 1734+4	024B  AF      	        xor     a
 363: 1738+10	024C  C9      	        ret
 364:				
 365:     -	024D          	ad_fail:
 366: 1748+10	024D  D1      	        pop     de
 367: 1758+10	024E  E1      	        pop     hl
 368: 1768+7	024F  3E01    	        ld      a, 1
 369: 1775+4	0251  B7      	        or      a
 370: 1779+10	0252  C9      	        ret
 371:				
 372:				; ============================================================================
 373:				; Video RAM Test (SY6545 CRTC transparent addressing)
 374:				; Tests 2KB of VRAM at 0x0000-0x07FF via CRTC registers
 375:				; ============================================================================
 376:     -	0253          	vram_test:
 377: 1789+10	0253  11DB04  	        ld      de, msg_vram
 378: 1799+17	0256  CD1D04  	        call    print
 379:				
 380:				        ; Save current VRAM contents to backup buffer at 0x9000
 381: 1816+10	0259  210000  	        ld      hl, 0               ; VRAM address
 382: 1826+10	025C  110090  	        ld      de, 09000h          ; Backup buffer
 383: 1836+10	025F  010008  	        ld      bc, 0800h           ; 2KB
 384:     -	0262          	vram_save:
 385: 1846+11	0262  C5      	        push    bc
 386: 1857+11	0263  D5      	        push    de
 387: 1868+17	0264  CDD303  	        call    crtc_read           ; Read VRAM[HL] -> A
 388: 1885+10	0267  D1      	        pop     de
 389: 1895+7	0268  12      	        ld      (de), a             ; Save to backup
 390: 1902+6	0269  13      	        inc     de
 391: 1908+6	026A  23      	        inc     hl
 392: 1914+10	026B  C1      	        pop     bc
 393: 1924+6	026C  0B      	        dec     bc
 394: 1930+4	026D  78      	        ld      a, b
 395: 1934+4	026E  B1      	        or      c
 396: 1938+7+5	026F  20F1    	        jr      nz, vram_save
 397:				
 398:				        ; Perform sliding-data test on VRAM 0x0000-0x07FF
 399: 1945+10	0271  210000  	        ld      hl, 0
 400: 1955+10	0274  11FF07  	        ld      de, 07FFh
 401: 1965+17	0277  CDB402  	        call    vram_sliding
 402: 1982+7+5	027A  2015    	        jr      nz, vram_fail
 403:				
 404:				        ; Perform address-data test on VRAM 0x0000-0x07FF
 405: 1989+10	027C  210000  	        ld      hl, 0
 406: 1999+10	027F  11FF07  	        ld      de, 07FFh
 407: 2009+17	0282  CD0603  	        call    vram_address
 408: 2026+7+5	0285  200A    	        jr      nz, vram_fail
 409:				
 410:				        ; Restore VRAM contents from backup
 411: 2033+17	0287  CD9B02  	        call    vram_restore
 412:				
 413: 2050+10	028A  111305  	        ld      de, msg_pass
 414: 2060+17	028D  CD1D04  	        call    print
 415: 2077+10	0290  C9      	        ret
 416:				
 417:     -	0291          	vram_fail:
 418:				        ; Restore VRAM contents even on failure
 419: 2087+17	0291  CD9B02  	        call    vram_restore
 420:				
 421: 2104+10	0294  111A05  	        ld      de, msg_fail
 422: 2114+17	0297  CD1D04  	        call    print
 423: 2131+10	029A  C9      	        ret
 424:				
 425:     -	029B          	vram_restore:
 426: 2141+10	029B  210000  	        ld      hl, 0               ; VRAM address
 427: 2151+10	029E  110090  	        ld      de, 09000h          ; Backup buffer
 428: 2161+10	02A1  010008  	        ld      bc, 0800h           ; 2KB
 429:     -	02A4          	vram_rest_loop:
 430: 2171+11	02A4  C5      	        push    bc
 431: 2182+11	02A5  E5      	        push    hl
 432: 2193+7	02A6  1A      	        ld      a, (de)             ; Get from backup
 433: 2200+17	02A7  CDF403  	        call    crtc_write          ; Write VRAM[HL] <- A
 434: 2217+10	02AA  E1      	        pop     hl
 435: 2227+6	02AB  23      	        inc     hl
 436: 2233+6	02AC  13      	        inc     de
 437: 2239+10	02AD  C1      	        pop     bc
 438: 2249+6	02AE  0B      	        dec     bc
 439: 2255+4	02AF  78      	        ld      a, b
 440: 2259+4	02B0  B1      	        or      c
 441: 2263+7+5	02B1  20F1    	        jr      nz, vram_rest_loop
 442: 2270+10	02B3  C9      	        ret
 443:				
 444:				; ============================================================================
 445:				; VRAM Sliding Data Test
 446:				; Input: HL = start VRAM addr, DE = end VRAM addr
 447:				; Output: Z=pass, NZ=fail
 448:				; ============================================================================
 449:     -	02B4          	vram_sliding:
 450: 2280+11	02B4  E5      	        push    hl
 451: 2291+11	02B5  D5      	        push    de
 452:				
 453: 2302+7	02B6  0601    	        ld      b, 1                ; Initial pattern 0x01
 454:     -	02B8          	vsd_outer:
 455: 2309+7	02B8  0E08    	        ld      c, 8                ; 8 bit positions
 456:				
 457:     -	02BA          	vsd_bit:
 458: 2316+10	02BA  D1      	        pop     de
 459: 2326+10	02BB  E1      	        pop     hl
 460: 2336+11	02BC  E5      	        push    hl
 461: 2347+11	02BD  D5      	        push    de
 462:				
 463:				        ; Write pattern B to all VRAM locations
 464:     -	02BE          	vsd_write:
 465: 2358+11	02BE  C5      	        push    bc
 466: 2369+11	02BF  D5      	        push    de
 467: 2380+11	02C0  E5      	        push    hl
 468: 2391+4	02C1  78      	        ld      a, b                ; Pattern to write
 469: 2395+17	02C2  CDF403  	        call    crtc_write          ; Write to VRAM[HL]
 470: 2412+10	02C5  E1      	        pop     hl
 471: 2422+10	02C6  D1      	        pop     de
 472: 2432+10	02C7  C1      	        pop     bc
 473:				        ; Check if HL == DE (end)
 474: 2442+4	02C8  7C      	        ld      a, h
 475: 2446+4	02C9  BA      	        cp      d
 476: 2450+7+5	02CA  2004    	        jr      nz, vsd_winc
 477: 2457+4	02CC  7D      	        ld      a, l
 478: 2461+4	02CD  BB      	        cp      e
 479: 2465+7+5	02CE  2803    	        jr      z, vsd_verify
 480:     -	02D0          	vsd_winc:
 481: 2472+6	02D0  23      	        inc     hl
 482: 2478+12	02D1  18EB    	        jr      vsd_write
 483:				
 484:     -	02D3          	vsd_verify:
 485:				        ; Verify pattern B in all VRAM locations
 486: 2490+10	02D3  D1      	        pop     de
 487: 2500+10	02D4  E1      	        pop     hl
 488: 2510+11	02D5  E5      	        push    hl
 489: 2521+11	02D6  D5      	        push    de
 490:				
 491:     -	02D7          	vsd_read:
 492: 2532+11	02D7  C5      	        push    bc
 493: 2543+11	02D8  D5      	        push    de
 494: 2554+11	02D9  E5      	        push    hl
 495: 2565+17	02DA  CDD303  	        call    crtc_read           ; Read VRAM[HL] -> A
 496: 2582+10	02DD  E1      	        pop     hl
 497: 2592+10	02DE  D1      	        pop     de
 498: 2602+10	02DF  C1      	        pop     bc                  ; Restore pattern (B) and counter (C)
 499: 2612+4	02E0  B8      	        cp      b                   ; Compare read value (A) with expected pattern (B)
 500: 2616+7+5	02E1  201D    	        jr      nz, vsd_fail
 501:				        ; Check if HL == DE (end)
 502: 2623+4	02E3  7C      	        ld      a, h
 503: 2627+4	02E4  BA      	        cp      d
 504: 2631+7+5	02E5  2004    	        jr      nz, vsd_rinc
 505: 2638+4	02E7  7D      	        ld      a, l
 506: 2642+4	02E8  BB      	        cp      e
 507: 2646+7+5	02E9  2803    	        jr      z, vsd_next
 508:     -	02EB          	vsd_rinc:
 509: 2653+6	02EB  23      	        inc     hl
 510: 2659+12	02EC  18E9    	        jr      vsd_read
 511:				
 512:     -	02EE          	vsd_next:
 513: 2671+8	02EE  CB00    	        rlc     b                   ; Rotate pattern left
 514: 2679+4	02F0  0D      	        dec     c                   ; Decrement bit counter
 515: 2683+7+5	02F1  20C7    	        jr      nz, vsd_bit
 516:				
 517:				        ; After 8 rotations of 0x01, switch to 0xFE
 518: 2690+4	02F3  78      	        ld      a, b
 519: 2694+7	02F4  FE01    	        cp      1
 520: 2701+7+5	02F6  2004    	        jr      nz, vsd_done
 521: 2708+7	02F8  06FE    	        ld      b, 0FEh
 522: 2715+12	02FA  18BC    	        jr      vsd_outer
 523:				
 524:     -	02FC          	vsd_done:
 525: 2727+10	02FC  D1      	        pop     de
 526: 2737+10	02FD  E1      	        pop     hl
 527: 2747+4	02FE  AF      	        xor     a                   ; Z=pass
 528: 2751+10	02FF  C9      	        ret
 529:				
 530:     -	0300          	vsd_fail:
 531: 2761+10	0300  D1      	        pop     de
 532: 2771+10	0301  E1      	        pop     hl
 533: 2781+7	0302  3E01    	        ld      a, 1
 534: 2788+4	0304  B7      	        or      a                   ; NZ=fail
 535: 2792+10	0305  C9      	        ret
 536:				
 537:				; ============================================================================
 538:				; VRAM Address Data Test
 539:				; Input: HL = start VRAM addr, DE = end VRAM addr
 540:				; Output: Z=pass, NZ=fail
 541:				; ============================================================================
 542:     -	0306          	vram_address:
 543: 2802+11	0306  E5      	        push    hl
 544: 2813+11	0307  D5      	        push    de
 545:				
 546:				        ; Write low byte of address to each location
 547: 2824+10	0308  D1      	        pop     de
 548: 2834+10	0309  E1      	        pop     hl
 549: 2844+11	030A  E5      	        push    hl
 550: 2855+11	030B  D5      	        push    de
 551:				
 552:     -	030C          	vad_wlo:
 553: 2866+11	030C  D5      	        push    de
 554: 2877+11	030D  E5      	        push    hl
 555: 2888+4	030E  7D      	        ld      a, l                ; Low byte of address
 556: 2892+17	030F  CDF403  	        call    crtc_write          ; Write to VRAM[HL]
 557: 2909+10	0312  E1      	        pop     hl
 558: 2919+10	0313  D1      	        pop     de
 559:				        ; Check if HL == DE
 560: 2929+4	0314  7C      	        ld      a, h
 561: 2933+4	0315  BA      	        cp      d
 562: 2937+7+5	0316  2004    	        jr      nz, vad_wlinc
 563: 2944+4	0318  7D      	        ld      a, l
 564: 2948+4	0319  BB      	        cp      e
 565: 2952+7+5	031A  2803    	        jr      z, vad_vlo
 566:     -	031C          	vad_wlinc:
 567: 2959+6	031C  23      	        inc     hl
 568: 2965+12	031D  18ED    	        jr      vad_wlo
 569:				
 570:     -	031F          	vad_vlo:
 571:				        ; Verify low bytes
 572: 2977+10	031F  D1      	        pop     de
 573: 2987+10	0320  E1      	        pop     hl
 574: 2997+11	0321  E5      	        push    hl
 575: 3008+11	0322  D5      	        push    de
 576:				
 577:     -	0323          	vad_rlo:
 578: 3019+11	0323  D5      	        push    de
 579: 3030+11	0324  E5      	        push    hl
 580: 3041+17	0325  CDD303  	        call    crtc_read           ; Read VRAM[HL] -> A
 581: 3058+10	0328  E1      	        pop     hl
 582: 3068+10	0329  D1      	        pop     de
 583: 3078+4	032A  BD      	        cp      l                   ; Compare with expected (low byte of addr)
 584: 3082+7+5	032B  203F    	        jr      nz, vad_fail
 585:				        ; Check if HL == DE
 586: 3089+4	032D  7C      	        ld      a, h
 587: 3093+4	032E  BA      	        cp      d
 588: 3097+7+5	032F  2004    	        jr      nz, vad_rlinc
 589: 3104+4	0331  7D      	        ld      a, l
 590: 3108+4	0332  BB      	        cp      e
 591: 3112+7+5	0333  2803    	        jr      z, vad_whi
 592:     -	0335          	vad_rlinc:
 593: 3119+6	0335  23      	        inc     hl
 594: 3125+12	0336  18EB    	        jr      vad_rlo
 595:				
 596:     -	0338          	vad_whi:
 597:				        ; Write high byte of address to each location
 598: 3137+10	0338  D1      	        pop     de
 599: 3147+10	0339  E1      	        pop     hl
 600: 3157+11	033A  E5      	        push    hl
 601: 3168+11	033B  D5      	        push    de
 602:				
 603:     -	033C          	vad_wh:
 604: 3179+11	033C  D5      	        push    de
 605: 3190+11	033D  E5      	        push    hl
 606: 3201+4	033E  7C      	        ld      a, h                ; High byte of address
 607: 3205+17	033F  CDF403  	        call    crtc_write          ; Write to VRAM[HL]
 608: 3222+10	0342  E1      	        pop     hl
 609: 3232+10	0343  D1      	        pop     de
 610:				        ; Check if HL == DE
 611: 3242+4	0344  7C      	        ld      a, h
 612: 3246+4	0345  BA      	        cp      d
 613: 3250+7+5	0346  2004    	        jr      nz, vad_whinc
 614: 3257+4	0348  7D      	        ld      a, l
 615: 3261+4	0349  BB      	        cp      e
 616: 3265+7+5	034A  2803    	        jr      z, vad_vhi
 617:     -	034C          	vad_whinc:
 618: 3272+6	034C  23      	        inc     hl
 619: 3278+12	034D  18ED    	        jr      vad_wh
 620:				
 621:     -	034F          	vad_vhi:
 622:				        ; Verify high bytes
 623: 3290+10	034F  D1      	        pop     de
 624: 3300+10	0350  E1      	        pop     hl
 625: 3310+11	0351  E5      	        push    hl
 626: 3321+11	0352  D5      	        push    de
 627:				
 628:     -	0353          	vad_rhi:
 629: 3332+11	0353  D5      	        push    de
 630: 3343+11	0354  E5      	        push    hl
 631: 3354+17	0355  CDD303  	        call    crtc_read           ; Read VRAM[HL] -> A
 632: 3371+10	0358  E1      	        pop     hl
 633: 3381+10	0359  D1      	        pop     de
 634: 3391+4	035A  BC      	        cp      h                   ; Compare with expected (high byte of addr)
 635: 3395+7+5	035B  200F    	        jr      nz, vad_fail
 636:				        ; Check if HL == DE
 637: 3402+4	035D  7C      	        ld      a, h
 638: 3406+4	035E  BA      	        cp      d
 639: 3410+7+5	035F  2004    	        jr      nz, vad_rhinc
 640: 3417+4	0361  7D      	        ld      a, l
 641: 3421+4	0362  BB      	        cp      e
 642: 3425+7+5	0363  2803    	        jr      z, vad_done
 643:     -	0365          	vad_rhinc:
 644: 3432+6	0365  23      	        inc     hl
 645: 3438+12	0366  18EB    	        jr      vad_rhi
 646:				
 647:     -	0368          	vad_done:
 648: 3450+10	0368  D1      	        pop     de
 649: 3460+10	0369  E1      	        pop     hl
 650: 3470+4	036A  AF      	        xor     a                   ; Z=pass
 651: 3474+10	036B  C9      	        ret
 652:				
 653:     -	036C          	vad_fail:
 654: 3484+10	036C  D1      	        pop     de
 655: 3494+10	036D  E1      	        pop     hl
 656: 3504+7	036E  3E01    	        ld      a, 1
 657: 3511+4	0370  B7      	        or      a                   ; NZ=fail
 658: 3515+10	0371  C9      	        ret
 659:				
 660:				; ============================================================================
 661:				; Attribute RAM Test (SY6545 CRTC transparent addressing)
 662:				; Tests 2KB of Attribute RAM at 0x0800-0x0FFF via CRTC registers
 663:				; This is the fourth video test from diag4.mac (vatst)
 664:				; ============================================================================
 665:     -	0372          	attr_test:
 666: 3525+10	0372  11F504  	        ld      de, msg_attr
 667: 3535+17	0375  CD1D04  	        call    print
 668:				
 669:				        ; Save current Attribute RAM contents to backup buffer at 0x9800
 670: 3552+10	0378  210008  	        ld      hl, 0800h           ; Attribute RAM starts at 0x800
 671: 3562+10	037B  110098  	        ld      de, 09800h          ; Backup buffer (after VRAM backup)
 672: 3572+10	037E  010008  	        ld      bc, 0800h           ; 2KB
 673:     -	0381          	attr_save:
 674: 3582+11	0381  C5      	        push    bc
 675: 3593+11	0382  D5      	        push    de
 676: 3604+17	0383  CDD303  	        call    crtc_read           ; Read VRAM[HL] -> A
 677: 3621+10	0386  D1      	        pop     de
 678: 3631+7	0387  12      	        ld      (de), a             ; Save to backup
 679: 3638+6	0388  13      	        inc     de
 680: 3644+6	0389  23      	        inc     hl
 681: 3650+10	038A  C1      	        pop     bc
 682: 3660+6	038B  0B      	        dec     bc
 683: 3666+4	038C  78      	        ld      a, b
 684: 3670+4	038D  B1      	        or      c
 685: 3674+7+5	038E  20F1    	        jr      nz, attr_save
 686:				
 687:				        ; Perform sliding-data test on Attribute RAM 0x0800-0x0FFF
 688: 3681+10	0390  210008  	        ld      hl, 0800h
 689: 3691+10	0393  11FF0F  	        ld      de, 0FFFh
 690: 3701+17	0396  CDB402  	        call    vram_sliding        ; Reuse VRAM sliding test
 691: 3718+7+5	0399  2015    	        jr      nz, attr_fail
 692:				
 693:				        ; Perform address-data test on Attribute RAM 0x0800-0x0FFF
 694: 3725+10	039B  210008  	        ld      hl, 0800h
 695: 3735+10	039E  11FF0F  	        ld      de, 0FFFh
 696: 3745+17	03A1  CD0603  	        call    vram_address        ; Reuse VRAM address test
 697: 3762+7+5	03A4  200A    	        jr      nz, attr_fail
 698:				
 699:				        ; Restore Attribute RAM contents from backup
 700: 3769+17	03A6  CDBA03  	        call    attr_restore
 701:				
 702: 3786+10	03A9  111305  	        ld      de, msg_pass
 703: 3796+17	03AC  CD1D04  	        call    print
 704: 3813+10	03AF  C9      	        ret
 705:				
 706:     -	03B0          	attr_fail:
 707:				        ; Restore Attribute RAM contents even on failure
 708: 3823+17	03B0  CDBA03  	        call    attr_restore
 709:				
 710: 3840+10	03B3  111A05  	        ld      de, msg_fail
 711: 3850+17	03B6  CD1D04  	        call    print
 712: 3867+10	03B9  C9      	        ret
 713:				
 714:     -	03BA          	attr_restore:
 715: 3877+10	03BA  210008  	        ld      hl, 0800h           ; Attribute RAM address
 716: 3887+10	03BD  110098  	        ld      de, 09800h          ; Backup buffer
 717: 3897+10	03C0  010008  	        ld      bc, 0800h           ; 2KB
 718:     -	03C3          	attr_rest_loop:
 719: 3907+11	03C3  C5      	        push    bc
 720: 3918+11	03C4  E5      	        push    hl
 721: 3929+7	03C5  1A      	        ld      a, (de)             ; Get from backup
 722: 3936+17	03C6  CDF403  	        call    crtc_write          ; Write VRAM[HL] <- A
 723: 3953+10	03C9  E1      	        pop     hl
 724: 3963+6	03CA  23      	        inc     hl
 725: 3969+6	03CB  13      	        inc     de
 726: 3975+10	03CC  C1      	        pop     bc
 727: 3985+6	03CD  0B      	        dec     bc
 728: 3991+4	03CE  78      	        ld      a, b
 729: 3995+4	03CF  B1      	        or      c
 730: 3999+7+5	03D0  20F1    	        jr      nz, attr_rest_loop
 731: 4006+10	03D2  C9      	        ret
 732:				
 733:				; ============================================================================
 734:				; CRTC VRAM Read - Read byte from VRAM via SY6545 transparent addressing
 735:				; Input: HL = VRAM address (0x0000-0x0FFF for char + attr RAM)
 736:				; Output: A = byte read
 737:				; Clobbers: BC
 738:				; 
 739:				; Protocol (from diag4.mac cr4/cr6):
 740:				;   1. OUT 0x1C, 0x12       (select R18 - Update Address High)
 741:				;   2. OUT 0x1D, H          (write high byte)
 742:				;   3. OUT 0x1C, 0x13       (select R19 - Update Address Low)  
 743:				;   4. OUT 0x1D, L          (write low byte)
 744:				;   5. OUT 0x1C, 0x1F       (strobe command)
 745:				;   6. Wait for IN 0x1C bit 7 = 1 (Update Ready)
 746:				;   7. IN 0x1F              (read VRAM data)
 747:				; ============================================================================
 748:     -	03D3          	crtc_read:
 749: 4016+11	03D3  E5      	        push    hl
 750:				        ; Mask address to 12 bits (0-0xFFF for char + attr)
 751: 4027+4	03D4  7C      	        ld      a, h
 752: 4031+7	03D5  E60F    	        and     0Fh
 753: 4038+4	03D7  67      	        ld      h, a
 754:				
 755:				        ; Select R18 and write high byte
 756: 4042+7	03D8  3E12    	        ld      a, 012h             ; R18 - Update Address High
 757: 4049+11	03DA  D31C    	        out     (crtc_reg), a
 758: 4060+4	03DC  7C      	        ld      a, h
 759: 4064+11	03DD  D31D    	        out     (crtc_data), a
 760:				
 761:				        ; Select R19 and write low byte
 762: 4075+7	03DF  3E13    	        ld      a, 013h             ; R19 - Update Address Low
 763: 4082+11	03E1  D31C    	        out     (crtc_reg), a
 764: 4093+4	03E3  7D      	        ld      a, l
 765: 4097+11	03E4  D31D    	        out     (crtc_data), a
 766:				
 767:				        ; Send strobe command
 768: 4108+7	03E6  3E1F    	        ld      a, strcmd
 769: 4115+11	03E8  D31C    	        out     (crtc_reg), a
 770:				
 771:				        ; Wait for Update Ready (bit 7 of port 0x1C)
 772:     -	03EA          	crtc_read_wait:
 773: 4126+11	03EA  DB1C    	        in      a, (crtc_reg)
 774: 4137+4	03EC  B7      	        or      a
 775: 4141+10	03ED  F2EA03  	        jp      p, crtc_read_wait   ; Loop while bit 7 = 0
 776:				
 777:				        ; Read VRAM data
 778: 4151+11	03F0  DB1F    	        in      a, (crtc_vram)
 779:				
 780: 4162+10	03F2  E1      	        pop     hl
 781: 4172+10	03F3  C9      	        ret
 782:				
 783:				; ============================================================================
 784:				; CRTC VRAM Write - Write byte to VRAM via SY6545 transparent addressing
 785:				; Input: HL = VRAM address (0x0000-0x0FFF for char + attr RAM), A = byte to write
 786:				; Clobbers: BC
 787:				;
 788:				; Protocol (from diag4.mac cr5/cr6):
 789:				;   1-6. Same as read (set address and strobe)
 790:				;   7. OUT 0x1F, A          (write VRAM data)
 791:				;   8. Wait for IN 0x1C bit 7 = 1 (write complete)
 792:				; ============================================================================
 793:     -	03F4          	crtc_write:
 794: 4182+11	03F4  E5      	        push    hl
 795: 4193+11	03F5  F5      	        push    af                  ; Save data byte
 796:				        ; Mask address to 12 bits (0-0xFFF for char + attr)
 797: 4204+4	03F6  7C      	        ld      a, h
 798: 4208+7	03F7  E60F    	        and     0Fh
 799: 4215+4	03F9  67      	        ld      h, a
 800:				
 801:				        ; Select R18 and write high byte
 802: 4219+7	03FA  3E12    	        ld      a, 012h             ; R18 - Update Address High
 803: 4226+11	03FC  D31C    	        out     (crtc_reg), a
 804: 4237+4	03FE  7C      	        ld      a, h
 805: 4241+11	03FF  D31D    	        out     (crtc_data), a
 806:				
 807:				        ; Select R19 and write low byte
 808: 4252+7	0401  3E13    	        ld      a, 013h             ; R19 - Update Address Low
 809: 4259+11	0403  D31C    	        out     (crtc_reg), a
 810: 4270+4	0405  7D      	        ld      a, l
 811: 4274+11	0406  D31D    	        out     (crtc_data), a
 812:				
 813:				        ; Send strobe command
 814: 4285+7	0408  3E1F    	        ld      a, strcmd
 815: 4292+11	040A  D31C    	        out     (crtc_reg), a
 816:				
 817:				        ; Wait for Update Ready (bit 7 of port 0x1C)
 818:     -	040C          	crtc_write_wait1:
 819: 4303+11	040C  DB1C    	        in      a, (crtc_reg)
 820: 4314+4	040E  B7      	        or      a
 821: 4318+10	040F  F20C04  	        jp      p, crtc_write_wait1 ; Loop while bit 7 = 0
 822:				
 823:				        ; Write VRAM data
 824: 4328+10	0412  F1      	        pop     af                  ; Restore data byte
 825: 4338+11	0413  D31F    	        out     (crtc_vram), a
 826:				
 827:				        ; Wait for write complete
 828:     -	0415          	crtc_write_wait2:
 829: 4349+11	0415  DB1C    	        in      a, (crtc_reg)
 830: 4360+4	0417  B7      	        or      a
 831: 4364+10	0418  F21504  	        jp      p, crtc_write_wait2 ; Loop while bit 7 = 0
 832:				
 833: 4374+10	041B  E1      	        pop     hl
 834: 4384+10	041C  C9      	        ret
 835:				
 836:				; ============================================================================
 837:				; Utility routines
 838:				; ============================================================================
 839:				
 840:     -	041D          	print:
 841: 4394+7	041D  0E09    	        ld      c, prtstr
 842: 4401+10	041F  C30500  	        jp      bdos
 843:				
 844:     -	0422          	print_hex16:
 845: 4411+4	0422  7C      	        ld      a, h
 846: 4415+17	0423  CD2704  	        call    print_hex8
 847: 4432+4	0426  7D      	        ld      a, l
 848:				
 849:     -	0427          	print_hex8:
 850: 4436+11	0427  F5      	        push    af
 851: 4447+4	0428  0F      	        rrca
 852: 4451+4	0429  0F      	        rrca
 853: 4455+4	042A  0F      	        rrca
 854: 4459+4	042B  0F      	        rrca
 855: 4463+17	042C  CD3004  	        call    print_nibble
 856: 4480+10	042F  F1      	        pop     af
 857:				
 858:     -	0430          	print_nibble:
 859: 4490+7	0430  E60F    	        and     00Fh
 860: 4497+7	0432  C630    	        add     a, 030h
 861: 4504+7	0434  FE3A    	        cp      03Ah
 862: 4511+7+5	0436  3802    	        jr      c, pn_out
 863: 4518+7	0438  C607    	        add     a, 7
 864:     -	043A          	pn_out:
 865: 4525+4	043A  5F      	        ld      e, a
 866: 4529+7	043B  0E02    	        ld      c, conout
 867: 4536+10	043D  C30500  	        jp      bdos
 868:				
 869:				; ============================================================================
 870:				; Messages
 871:				; ============================================================================
 872:     -	0440          	msg_banner:
 873:     -	0440  0D0A    	        db      13, 10
 874:     -	0442  3D3D3D20	        db      "=== izkaypro Emulator Diagnostics ===", 13, 10
	              697A6B61
	              7970726F
	              20456D75
	              6C61746F
	              72204469
	              61676E6F
	              73746963
	              73203D3D
	              3D0D0A
 875:     -	0469  42617365	        db      "Based on diag4.mac (c) 1983 NLS Inc.", 13, 10
	              64206F6E
	              20646961
	              67342E6D
	              61632028
	              63292031
	              39383320
	              4E4C5320
	              496E632E
	              0D0A
 876:     -	048F  0D0A24  	        db      13, 10, "$"
 877:				
 878:     -	0492          	msg_rom:
 879:     -	0492  524F4D20	        db      "ROM Checksum Test: $"
	              43686563
	              6B73756D
	              20546573
	              743A2024
 880:				
 881:     -	04A6          	msg_chksum:
 882:     -	04A6  307824  	        db      "0x$"
 883:				
 884:     -	04A9          	msg_ram1:
 885:     -	04A9  52414D20	        db      "RAM Test 0x4000-0x7FFF: $"
	              54657374
	              20307834
	              3030302D
	              30783746
	              46463A20
	              24
 886:				
 887:     -	04C2          	msg_ram2:
 888:     -	04C2  52414D20	        db      "RAM Test 0x8000-0xBFFF: $"
	              54657374
	              20307838
	              3030302D
	              30784246
	              46463A20
	              24
 889:				
 890:     -	04DB          	msg_vram:
 891:     -	04DB  5652414D	        db      "VRAM Test 0x0000-0x07FF: $"
	              20546573
	              74203078
	              30303030
	              2D307830
	              3746463A
	              2024
 892:				
 893:     -	04F5          	msg_attr:
 894:     -	04F5  41747472	        db      "Attr RAM Test 0x0800-0x0FFF: $"
	              2052414D
	              20546573
	              74203078
	              30383030
	              2D307830
	              4646463A
	              2024
 895:				
 896:     -	0513          	msg_pass:
 897:     -	0513  50415353	        db      "PASS", 13, 10, "$"
	              0D0A24
 898:				
 899:     -	051A          	msg_fail:
 900:     -	051A  4641494C	        db      "FAIL", 13, 10, "$"
	              0D0A24
 901:				
 902:     -	0521          	msg_done:
 903:     -	0521  0D0A    	        db      13, 10
 904:     -	0523  44696167	        db      "Diagnostics complete.", 13, 10, "$"
	              6E6F7374
	              69637320
	              636F6D70
	              6C657465
	              2E0D0A24
 905:				
 906:     -	053B          	msg_crlf:
 907:     -	053B  0D0A24  	        db      13, 10, "$"
 908:				
 909:				; ============================================================================
 910:				; Stack
 911:				; ============================================================================
 912:     -	053E          	        ds      64
 913:     -	057E          	stack:
 914:				
 915:     -	057E          	        end



Statistics:

     4	passes
     0	jr promotions
   101	symbols
  1086	bytes



Symbol Table:

ad_done          249      585
ad_fail          24D      589
ad_rhi           23A      570
ad_rhinc         246      582
ad_rlinc         223      547
ad_rlo           217      535
ad_vhi           236      566
ad_vlo           213      531
ad_wh            22A      554
ad_whi           226      550
ad_whinc         233      563
ad_wlinc         210      528
ad_wlo           207      519
address_data     201      513
attr_fail        3B0      944
attr_rest_loop   3C3      963
attr_restore     3BA      954
attr_save        381      897
attr_test        372      882
bdos           =05        5
bitport        =14        20
conout         =02        2
crtc_data      =1D        29
crtc_read        3D3      979
crtc_read_wait   3EA      1002
crtc_reg       =1C        28
crtc_vram      =1F        31
crtc_write       3F4      1012
crtc_write_wait1  40C      1036
crtc_write_wait2  415      1045
msg_attr         4F5      1269
msg_banner       440      1088
msg_chksum       4A6      1190
msg_crlf         53B      1339
msg_done         521      1313
msg_fail         51A      1306
msg_pass         513      1299
msg_ram1         4A9      1193
msg_ram2         4C2      1218
msg_rom          492      1170
msg_vram         4DB      1243
pn_out           43A      1082
print            41D      1053
print_hex16      422      1058
print_hex8       427      1063
print_nibble     430      1072
prtstr         =09        9
ram_fail1        190      400
ram_fail2        1B9      441
ram_test         16C      364
ram_test2        196      406
rom_calc_loop    152      338
rom_code_end     16C      364
rom_code_start   142      322
rom_no_carry     158      344
rom_return       130      304
rom_test         11C      284
sd_bit           1C6      454
sd_done          1F7      503
sd_fail          1FB      507
sd_next          1E9      489
sd_outer         1C4      452
sd_read          1DA      474
sd_rinc          1E6      486
sd_verify        1D6      470
sd_winc          1D3      467
sd_write         1CA      458
sliding_data     1C0      448
stack            57E      1406
start            100      256
strcmd         =1F        31
vad_done         368      872
vad_fail         36C      876
vad_rhi          353      851
vad_rhinc        365      869
vad_rlinc        335      821
vad_rlo          323      803
vad_vhi          34F      847
vad_vlo          31F      799
vad_wh           33C      828
vad_whi          338      824
vad_whinc        34C      844
vad_wlinc        31C      796
vad_wlo          30C      780
vram_address     306      774
vram_fail        291      657
vram_rest_loop   2A4      676
vram_restore     29B      667
vram_save        262      610
vram_sliding     2B4      692
vram_test        253      595
vsd_bit          2BA      698
vsd_done         2FC      764
vsd_fail         300      768
vsd_next         2EE      750
vsd_outer        2B8      696
vsd_read         2D7      727
vsd_rinc         2EB      747
vsd_verify       2D3      723
vsd_winc         2D0      720
vsd_write        2BE      702
